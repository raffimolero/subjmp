use super::Program;

impl Program {
    pub fn rle(&self) -> String {
        let mut out = [0_u8; 130 * 8];
        for (i, v) in self.mem.iter().enumerate() {
            let idx = ((i * 9) % 128) as usize * 8;

            let mut v = v.0 as u8;
            for i in idx..idx + 8 {
                out[i] |= v & 1;
                out[i + 1] |= (v & 1) << 1;
                v >>= 1;
            }
        }

        let line = out
            .chunks(64)
            .map(|chunk| {
                chunk
                    .iter()
                    .map(|b| match b {
                        0b_00 => 'A',
                        0b_01 => 'B',
                        0b_10 => 'C',
                        0b_11 => 'D',
                        _ => unreachable!(),
                    })
                    .collect::<String>()
            })
            .collect::<Vec<String>>()
            .join("\n");
        format!(
            "x = 230, y = 62, rule = Semaphore
2E2.6A2.E.E.6A2.3E.6A3.E2.6A3.CBC3ABCABDCBCBDBCBCDBACB3ACBCBCABC2DBAC
B$2.E.7A.3E.7A2.E2.7A.E.E.7A2.B14.D16.ADA6.A$2.E.7A.E.E.7A2.2E.7A.E.E
.7A2.CDBCD2.AC2D4.CAECACB10.A.A6.A$2E2.7A2.E2.7A2.E2.7A2.E2.7A6.D.B2.
D.E.FD.F2.A.A8.E.CBA6.C3.C2A$3.8A4.8A4.8A4.8A.2ABCAB.CAB3.A.DC.A.3A6.
3AF6.F2.D3.B.A$.E.8A2.E.8A2.E.8A2.E.8A.C8.ACBE.CBFA9.3A.E.A2.2AE3AF.E
4A$E10A.E10A.E10A.E10A.2DBACB5.2A3.B.F2.3A3.A4.5A.A.A2.A4.A$.8A.A2.8A
.A2.8A.A2.8A.A6.A7.C2D5.A.A2.A2.2A2.2A3.2AE.E.2A.A$.6A2.A3.6A2.A3.6A
2.A3.6A2.A2.6A11.EA2.A.A.E3.A.A.A.A3.F4.A.F$8.E.A9.E.A9.E.A9.E.A.A6.
3A3.F.2A2.3A.A.A.AEA.3A2.4A5.FDF$2.5A.AFA3.5A.AFA3.5A.AFA3.5A.AFA2.CB
.F.A3.2A.AE2.EA.5A.FA.E.3A.3A8.B$2.A3.A.A5.A3.A.A5.A3.A.A5.A3.A.A5.A
2.AE2A.E2A2.A.FA.A.3A.6A.2A3.A2.2D4.E$2.2A.2A.E.ACB.2A.2A.E.CBA.2A.2A
.E.3A.2A.2A.E.CBA.A.A.2A.A3.A2.A.A.A.A.3A2.A4.F.F2.AD.4D.AED$4.E2.A2.
A.A3.E2.A2.A.A3.E2.A2.A.A3.E2.A2.A.A.C2.E.AE.FA.A.AE.3A.A5.EAE4.D.A2D
A5.DA.D$3AEA.F.F.4AEA2.F.F.4AEA2.F.F.BCACFA2.F.F.3A2.D2.2A4.2A.A2.3A.
4A.A.E4.F.2DA2.4A.AD.D$A.B.A10.A11.A11.A9.A2.DE2.ACD4.4A.A4.4A.A5.D2.
4A2.A2.2D$2AC.8A2.BE2A.8AE12A10.2ACB4A.D5.2A.4AEA4.A.5D.2A.F.A2.A3D$
12.FC2.F.E7.F31.AF.E3.2A4.A.E.2AB2.D5.A3.3A.DE.D$5.3A.C2A2.E3.AF8.F.F
2A.3AF3A7.3A9.B4.A.A3.AFA.A.C2.D2.3A2.2AE.AEA3D$2.E.FA.C.B.A6.A10.D2.
2A2.E.A.A7.A.A8.E.2A2.A2.2AE.AD.ADA2.D2.A3.A2.3A.A$3.A.2AB.3A2.3A.E8.
2D.F4.2A.CBA.E.EA2.CBAE.A5.A.A.E.5A2.A.2DA4D2.2AEA3.5A$2.A.FA8.A.B.CE
A5.E.D.A3.A.A6.A2.A4.CF.A2.3A2.E4A2.A2.A13.E.E.E3.A$2.C2D4.AE.E3AC.D.
A3.F2DE2.3A.A.A4.2A.E2.2ABCB.2A2.A.A.A.E2.AEA2.15A3.D.4A$2.2B.3DB2.B
4.B.DEAF2A2.F.B.A.A.A.A3.E.A.A7.CBA2.ABCB4.E4.A15.A.D4.EA$2.A.FD4.E.
2A.A2.D3.A.E4.CACB.A.A.3AE2.ABC4.AE.B6.4A4.A3.3A.3A.3A.F.E3.2A.A$3.A.
FC2A3.A.E3.D3.A.2A8.3A.A.E.A.A.A2.3A.C8.7A4.A.A.A.A.A.A4.D.E2.F3AB$6.
B.A4.EAE2.DEAEA2.7A3.2A.A4.4A2.A.AE.F4.3A8.2A.A.A.A.A.A.A5.D3.3A.C$6.
3A2.A2.A5.A2.A4.3A.A.3A.A10.B2A5.3A5.3A.A.A.A.A.A.A.A.A4.F.E2.E4A$10.
F3A7.A.F4.A.A2.2A.2A6.6AC6A8.A.A.A.A.A.A.A.A.A.A7.2D.A$4.4AEA.E7.F.E
2AE.3A.14A14.8A.3A.3A.3A.3A.7A2.E2.3A.F$4.A2.A.A.A8.A3.A.A21.10A31.A.
A3.A2.A$4.2A.2AEA.E10A.3A.3A.3A.3A.3A.3A.A.40A.5A3.E$6.E.F13.A.3A.A.A
.A.A.A.A.A.A.A.A.A.A47.A.
{line}
$5.FA15.3A.3A.3A.3A.3A.3A.3A.A.46A$7.A
42.A.A$3.3A.A.ACB6AC2.4ACB4A2.B6ACBA7.A.46A$3.A.A2.2A9.B2A9.2AC9.3A4.
A46.A$3.CB40A.2A2.A.46A$8.E.E9.E.E9.E.E9.E.E.A.A.A$.6A2.A3.6A2.A3.6A
2.A3.6A2.A2.A.A.46A$8A.A2.8A.A2.8A.A2.8A.A2.A.A46.A$5A2.A.E2.5A2.A.E
2.5A2.A.E2.5A2.A.E2.A.A.46A$10AF.10AF.10AF.10AF.A.A.A$8A.F2.8A.F2.8A.
F2.8A.F2.A.A.46A$8A4.8A4.8A4.8A4.A.A46.A$11A.11A.11A.11A.A.A.46A$11A.
11A.11A.11A.A.A.A$.9A3.9A3.9A3.9A2.A.A.46A$48.A.A46.A$.9A3.9A3.9A3.9A
2.A.A.46A$11A.11A.11A.11A.A.A.A$11A.11A.11A.11A.A.A.46A$8A4.8A4.8A4.
8A4.A.A46.A$8A.F2.8A.F2.8A.F2.8A.F2.A.A.46A$10AF.10AF.10AF.10AF.A.A.A
$5A2.A.E2.5A2.A.E2.5A2.A.E2.5A2.A.E2.A.A.46A$8A.A2.8A.A2.8A.A2.8A.A2.
A.A46.A$.6A2.A3.6A2.A3.6A2.A3.6A2.A2.A.A.46A$8.E.E9.E.E9.E.E9.F.E.A.A
.A$2.BCA2.AB35AC.2A2.A.46A$2.A.A2.C2A9.3A9.3A9.3A4.A46.A$2.5A2.5ACB3A
2.CB6ACB2.3ACB5A7.48A!"
        )
    }
}
